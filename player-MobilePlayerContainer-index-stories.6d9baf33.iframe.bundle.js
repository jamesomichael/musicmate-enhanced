"use strict";(self.webpackChunkmusicmate_enhanced=self.webpackChunkmusicmate_enhanced||[]).push([[1066],{"./components/player/MiniPlayer/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),_barrel_optimize_names_FaVolumeHigh_react_icons_fa6__WEBPACK_IMPORTED_MODULE_2__=(__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),__webpack_require__("__barrel_optimize__?names=FaCircleUser,FaRegCircleUser!=!./node_modules/react-icons/fa6/index.mjs")),_barrel_optimize_names_IoIosPause_IoIosPlay_react_icons_io__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("__barrel_optimize__?names=IoIosMusicalNotes,IoIosPause,IoIosPlay!=!./node_modules/react-icons/io/index.mjs"),_components_shared_FadeInSlide__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./components/shared/FadeInSlide/index.tsx"),_hooks_player_usePlayerControls__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./hooks/player/usePlayerControls.ts"),_redux_hooks__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./redux/hooks.ts"),_redux_slices_playerSlice__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./redux/slices/playerSlice.ts"),_redux_slices_userSlice__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./redux/slices/userSlice.ts");const MiniPlayer=()=>{var _item_album_images_,_item_album_images,_item_album,_item_album_images_1,_item_album_images1,_item_album1;const{isExternal,item,device}=(0,_redux_hooks__WEBPACK_IMPORTED_MODULE_6__.GV)(_redux_slices_playerSlice__WEBPACK_IMPORTED_MODULE_7__.Lv),userHasPremium=(0,_redux_hooks__WEBPACK_IMPORTED_MODULE_6__.GV)(_redux_slices_userSlice__WEBPACK_IMPORTED_MODULE_8__.re),{isPlaying,pause,resume}=(0,_hooks_player_usePlayerControls__WEBPACK_IMPORTED_MODULE_5__.A)();return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"relative p-2 h-14 rounded-md bg-black grid grid-cols-[1fr_2.5rem] overflow-hidden",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"absolute inset-0 bg-cover bg-center blur-3xl scale-125",style:{backgroundImage:`url(${null===(_item_album=item.album)||void 0===_item_album||null===(_item_album_images=_item_album.images)||void 0===_item_album_images||null===(_item_album_images_=_item_album_images[0])||void 0===_item_album_images_?void 0:_item_album_images_.url})`}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"absolute inset-0 bg-white/10"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"relative flex gap-2 truncate",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"bg-cover bg-center h-full aspect-square rounded",style:{backgroundImage:`url(${null===(_item_album1=item.album)||void 0===_item_album1||null===(_item_album_images1=_item_album1.images)||void 0===_item_album_images1||null===(_item_album_images_1=_item_album_images1[0])||void 0===_item_album_images_1?void 0:_item_album_images_1.url})`}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"w-full flex flex-col gap-0.5 justify-center truncate",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_shared_FadeInSlide__WEBPACK_IMPORTED_MODULE_4__.A,{className:"leading-5 font-funnel text-white font-medium text-sm truncate",children:item.name},item.id),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"truncate flex overflow-hidden",children:isExternal?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"flex items-center gap-1.5 text-spotify-green truncate",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_barrel_optimize_names_FaVolumeHigh_react_icons_fa6__WEBPACK_IMPORTED_MODULE_2__.c2D,{className:"h-3 w-3"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"text-xs font-funnel truncate",children:device.name})]}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"font-funnel text-neutral-400 text-xs truncate",children:item.artists.map(artist=>artist.name).join(", ")})})]})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"relative flex mr-1 justify-end items-center",children:isPlaying?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_barrel_optimize_names_IoIosPause_IoIosPlay_react_icons_io__WEBPACK_IMPORTED_MODULE_3__.ofy,{onClick:e=>{e.stopPropagation(),pause()},className:"h-7 w-7 text-white active:scale-95 "+(userHasPremium?"":"opacity-25 pointer-events-none cursor-not-allowed")}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_barrel_optimize_names_IoIosPause_IoIosPlay_react_icons_io__WEBPACK_IMPORTED_MODULE_3__.gLA,{onClick:e=>{e.stopPropagation(),resume()},className:"h-7 w-7 text-white active:scale-95 "+(userHasPremium?"":"opacity-25 pointer-events-none cursor-not-allowed")})})]})},__WEBPACK_DEFAULT_EXPORT__=MiniPlayer;MiniPlayer.__docgenInfo={description:"",methods:[],displayName:"MiniPlayer"}},"./components/player/MobilePlayerContainer/index.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>index_stories});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),react_dom=__webpack_require__("./node_modules/next/dist/compiled/react-dom/index.js"),AnimatePresence=__webpack_require__("./node_modules/framer-motion/dist/es/components/AnimatePresence/index.mjs"),proxy=__webpack_require__("./node_modules/framer-motion/dist/es/render/components/motion/proxy.mjs"),MiniPlayer=__webpack_require__("./components/player/MiniPlayer/index.tsx"),MobilePlayer=__webpack_require__("./components/player/MobilePlayer/index.tsx"),usePlayer=__webpack_require__("./hooks/player/usePlayer.ts"),hooks=__webpack_require__("./redux/hooks.ts"),playerSlice=__webpack_require__("./redux/slices/playerSlice.ts");const MobilePlayerContainer=()=>{(0,usePlayer.A)();const{isPlaying=!1,isActive=!1,isPrivate=!1,isPodcast=!1,item}=(0,hooks.GV)(playerSlice.Lv),[isExpanded,setIsExpanded]=(0,react.useState)(!1);return!isPlaying&&!isActive||isActive&&!isPlaying&&!item||isPodcast||isPrivate?null:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{onClick:()=>setIsExpanded(!0),className:"absolute w-full bottom-20 px-2",children:(0,jsx_runtime.jsx)(MiniPlayer.A,{})}),(0,react_dom.createPortal)((0,jsx_runtime.jsx)(AnimatePresence.N,{children:isExpanded&&(0,jsx_runtime.jsx)(proxy.P.div,{className:"lg:hidden fixed inset-0 z-50 w-screen min-h-[100dvh] overflow-hidden",initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",stiffness:400,damping:50},children:(0,jsx_runtime.jsx)(MobilePlayer.A,{onClose:()=>setIsExpanded(!1)})},"mobile-player")}),document.body)]})},player_MobilePlayerContainer=MobilePlayerContainer;MobilePlayerContainer.__docgenInfo={description:"",methods:[],displayName:"MobilePlayerContainer"};var tracks=__webpack_require__("./mocks/tracks.ts"),StoreProvider=__webpack_require__("./redux/StoreProvider.tsx");const index_stories={title:"Player/MobilePlayerContainer",component:player_MobilePlayerContainer,args:{onClose:()=>{}},globals:{viewport:{value:"iphone14promax",isRotated:!1}},parameters:{layout:"fullscreen"},decorators:[Story=>(0,jsx_runtime.jsx)(StoreProvider.A,{preloadedState:{player:{playbackState:{is_playing:!0,repeat_state:"off",item:tracks.u,progress_ms:14e4,device:{name:"James's iPhone"}}}},children:(0,jsx_runtime.jsx)("div",{className:"w-screen overflow-hidden",children:(0,jsx_runtime.jsx)(Story,{})})})]},Default={},__namedExportsOrder=["Default"]},"./hooks/player/usePlayer.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>player_usePlayer});var react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),hooks=__webpack_require__("./redux/hooks.ts"),playerSlice=__webpack_require__("./redux/slices/playerSlice.ts"),axios=__webpack_require__("./node_modules/axios/lib/axios.js");var console=__webpack_require__("./node_modules/console-browserify/index.js");const player_usePlayer=()=>{const dispatch=(0,hooks.jL)(),[player,setPlayer]=(0,react.useState)(null);(0,react.useEffect)(()=>{const script=document.createElement("script");script.src="https://sdk.scdn.co/spotify-player.js",script.async=!0,document.body.appendChild(script),window.onSpotifyWebPlaybackSDKReady=()=>{const spotifyPlayer=new window.Spotify.Player({name:"musicmate",getOAuthToken:async cb=>{cb(await(async()=>{const response=await axios.A.get("/api/token"),{token}=response.data;return token})())},volume:.5});setPlayer(spotifyPlayer),spotifyPlayer.addListener("ready",({device_id})=>{console.log("[Player] Ready with device ID:",device_id),dispatch((0,playerSlice.U5)(device_id)),dispatch((0,playerSlice._1)(!0))}),spotifyPlayer.addListener("not_ready",({device_id})=>{console.log(`[Player] Device ID '${device_id}' has gone offline.`)}),spotifyPlayer.addListener("player_state_changed",state=>{if(state){var _track_album_uri,_track_album,_track_artists;console.log("[Player] Player state changed:",state);const track=state.track_window.current_track,progress=state.position,context=state.context;var _track_album_uri_split_;const albumId=null!==(_track_album_uri_split_=null===(_track_album=track.album)||void 0===_track_album||null===(_track_album_uri=_track_album.uri)||void 0===_track_album_uri?void 0:_track_album_uri.split(":")[2])&&void 0!==_track_album_uri_split_?_track_album_uri_split_:null,artistsWithArtistId=null===(_track_artists=track.artists)||void 0===_track_artists?void 0:_track_artists.map(artist=>{var _artist_uri;return{...artist,id:null===(_artist_uri=artist.uri)||void 0===_artist_uri?void 0:_artist_uri.split(":")[2]}}),formattedTrack={...track,artists:artistsWithArtistId,album:{...track.album,...albumId&&{id:albumId}}};dispatch((0,playerSlice.HW)({isPlaying:!state.paused,track:formattedTrack,progress,context}))}}),spotifyPlayer.addListener("initialization_error",({message})=>console.error("[Player] Initialization error:",message)),spotifyPlayer.addListener("authentication_error",({message})=>console.error("[Player] Authentication error:",message)),spotifyPlayer.addListener("account_error",({message})=>console.error("[Player] Account error:",message)),spotifyPlayer.addListener("playback_error",({message})=>console.error("[Player] Playback error:",message)),spotifyPlayer.connect()},dispatch((0,playerSlice.To)());const intervalId=setInterval(()=>{dispatch((0,playerSlice.To)())},2e4);return()=>{clearInterval(intervalId),player&&player.disconnect(),document.body.removeChild(script)}},[])}}}]);